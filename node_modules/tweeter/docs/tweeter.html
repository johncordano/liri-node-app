<!DOCTYPE html>  <html> <head>   <title>tweeter.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="tweeter.friends.html">                 tweeter.friends.js               </a>                                           <a class="source" href="tweeter.html">                 tweeter.js               </a>                                           <a class="source" href="tweeter.lists.html">                 tweeter.lists.js               </a>                                           <a class="source" href="tweeter.log.html">                 tweeter.log.js               </a>                                           <a class="source" href="tweeter.timelines.html">                 tweeter.timelines.js               </a>                                           <a class="source" href="tweeter.tweets.html">                 tweeter.tweets.js               </a>                                           <a class="source" href="util.html">                 util.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               tweeter.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Tweeter.js <br />
Copyright (c) 2011 James Schubert <br />
Released under the <a href="http://bit.ly/mit-license">MIT License</a>  </p>

<p>A node.js module with simple OAuth 1.0a dancing with Twitter's API.
It also provides a simple structure for lazy-loading (mixins?) API wrappers.</p>

<p>All requests emit <code>data</code>, <code>close</code>, <code>end</code>, and <code>error</code> events.
These events are passed back from the internal <code>http</code> and <code>https</code> clients.</p>

<p>Tweeter.js doesn't provide any session management. It's a new project, so that should 
be coming in the future.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">EventEmitter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">).</span><span class="nx">EventEmitter</span><span class="p">,</span>
    <span class="nx">util</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./util&#39;</span><span class="p">),</span>       <span class="c1">// includes util.format, remove in later version</span>
    <span class="nx">https</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">),</span>       <span class="c1">// for SSL requests</span>
    <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">),</span>         <span class="c1">// for normal requests</span>
    <span class="nx">qs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;querystring&#39;</span><span class="p">),</span>    <span class="c1">// create and parse parameter strings</span>
    <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;crypto&#39;</span><span class="p">),</span>     <span class="c1">// provides HMAC-SHA1</span>
    <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">),</span>           <span class="c1">// parses values sent from twitter to oauthCallback </span>
    <span class="nx">Log</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./tweeter.log&#39;</span><span class="p">),</span> <span class="c1">// simple logging with configurable streams</span>
    <span class="nx">noop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">};</span>          <span class="c1">// caches an empty function</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Creates a Tweeter object. <br />
Throws <code>Error</code> if a configuration object is <em>not</em> passed in <br />
Throws <code>Error</code> if configuration object doesn't have required elements</p>

<pre><code> Configuration object structure:
 {
     consumerKey:        'YOUR_KEY',     // *
     consumerSecret:     'YOUR_SECRET',  // *
     oauthCallback:      'FULL_URL',     // **
     token:              'YOUR_TOKEN',   // **
     tokenSecret:        'YOUR_SECRET',  // **
     accessToken:        'YOUR_TOKEN',   // **
     accessTokenSecret:  'YOUR_SECRET',  // **
     verifier:           'VERIFIER',     // **
     authorizeUrl:       'TWITTER_URL',  // ***
     test_nonce:         'TEST_NONCE',   // ****
     test_timestamp:     'TEST_TIME'     // ****
 }
</code></pre>

<p>* REQUIRED <br />
** usually set internally <br />
*** Provides a default <br />
**** For testing purposes  </p>

<p>Tweeter.js can be used easily with everyauth.  If so, everyauth remains 
responsible for the authentication and session management.  Pass the access token
and access token secret into the configuration object and Tweeter.js doesn't do 
authentication, just API request calls.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Tweeter</span> <span class="o">=</span> <span class="nx">exports</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Tweeter</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">o</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">o</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Invalid initialization object&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">consumerKey</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">consumerSecret</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Required call: new Tweeter({ consumerKey: &quot;your key&quot;, consumerSecret: &quot;your secret&quot; }&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_init</span><span class="p">();</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Initializes Tweeter object and attached APIs. <br />
The API 'mixin' structure allows for lazy-loading only desired APIs</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">apiBase</span> <span class="o">=</span> <span class="s1">&#39;api.twitter.com&#39;</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">useSSL</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">api</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">api</span> <span class="k">in</span> <span class="nx">self</span><span class="p">.</span><span class="nx">include</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">self</span><span class="p">.</span><span class="nx">include</span><span class="p">[</span><span class="nx">api</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">api</span><span class="p">[</span><span class="nx">api</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">self</span><span class="p">.</span><span class="nx">include</span><span class="p">[</span><span class="nx">api</span><span class="p">];</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">api</span><span class="p">[</span><span class="nx">api</span><span class="p">].</span><span class="nx">tweeter</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">logLevel</span><span class="p">.</span><span class="nx">ERROR</span><span class="p">,</span> <span class="s2">&quot;Could not create %j&quot;</span><span class="p">,</span> <span class="nx">api</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Instantiates tweeter.log object. -1 disables log output.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Log</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>TODO: Remove this for a defined getter/setter. <br />
Example: <br />
<code>tweeter.setLogLevel(1)</code> sets INFO and higher logging.</p>

<p>I'd much rather a more robust getter/setter: <br />
<code>tweeter.logLevel = 1</code> and <br />
<code>tweeter.logLevel = tweeter.logLevels.DEBUG</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setLogLevel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">logLevel</span> <span class="o">=</span> <span class="nx">level</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>TODO: Remove this at some point? <br />
Convenience object allows you to call <br />
<code>tweeter.logLevels.DEBUG</code> <br />
instead of <br />
<code>tweeter.log.logLevels.DEBUG</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">logLevels</span> <span class="o">=</span> <span class="nx">Log</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">logLevels</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Placeholder for API function references to be included. <br />
These will appear at <code>tweeter.api.[api_name]</code> <br />
For example, <code>tweeter.api.lists</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">include</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Creates a base options object for <code>host</code> and <code>headers</code> values.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">{</span> 
        <span class="nx">host</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">apiBase</span><span class="p">,</span>
        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
            <span class="s1">&#39;X-Target-URI&#39;</span><span class="o">:</span> <span class="nx">util</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;http%s://%s&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">useSSL</span><span class="o">?</span><span class="s1">&#39;s&#39;</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="nx">self</span><span class="p">.</span><span class="nx">apiBase</span><span class="p">),</span>
            <span class="s1">&#39;Connection&#39;</span><span class="o">:</span><span class="s1">&#39;Keep-Alive&#39;</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>extend method modified from underscore.js <code>_.extend</code>  </p>

<blockquote>
  <p>Underscore.js 1.1.7
  (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.
  Underscore is freely distributable under the MIT license.
  Portions of Underscore are inspired or borrowed from Prototype,
  Oliver Steele's Functional, and John Resig's Micro-Templating.
  For all details and documentation:</p>
  
  <p><a href="http://documentcloud.github.com/underscore">underscore.js</a></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">source</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">!==</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>The generic version of the main functions. <br />
Example: <br />
<code>tweeter.apiCall('get', '/1/statuses/home_timeline.json', null, callback);</code></p>

<p>This is the same as: <br />
<code>tweeter.get('/1/statuses/home_timeline.json', null, callback);</code>  </p>

<p>Or, you could include the timelines API module:  </p>

<pre><code> var Tweeter = require('./tweeter');
 require('./tweeter.timelines')(Tweeter);

 var tweeter = new Tweeter(my_conf);
 tweeter.api.timelines.home_timeline(options, callback);
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">apiCall</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">opt</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="p">(</span><span class="nx">method</span> <span class="k">in</span> <span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">,</span><span class="s1">&#39;post&#39;</span><span class="p">,</span><span class="s1">&#39;delete&#39;</span><span class="p">,</span><span class="s1">&#39;put&#39;</span><span class="p">,</span> <span class="s1">&#39;head&#39;</span><span class="p">])</span> <span class="p">){</span>
        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;get&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">prepareCall</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">opt</span><span class="p">,</span> <span class="nx">fn</span><span class="p">);</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">=</span> <span class="nx">method</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">[</span><span class="nx">method</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">self</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="nx">req</span><span class="p">),</span> <span class="nx">fn</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><em>Caution: side effects. These are on purpose.</em> <br />
Checks parameters as they are passed in, cleans things up.
Also, creates the full querystring from the path and options</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">prepareCall</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">opt</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">opt</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fn</span> <span class="o">=</span> <span class="nx">opt</span><span class="p">;</span>
        <span class="nx">opt</span> <span class="o">=</span> <span class="p">{</span> <span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nx">opt</span> <span class="o">=</span> <span class="nx">opt</span> <span class="o">||</span> <span class="p">{</span> <span class="p">};</span> <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">opt</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span> <span class="o">+</span> <span class="p">(</span><span class="nx">query</span><span class="o">?</span><span class="s1">&#39;?&#39;</span><span class="o">+</span><span class="nx">query</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">};</span>
    <span class="k">return</span> <span class="nx">req</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Creates a new client request for each call</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">execute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">cb</span> <span class="o">||</span> <span class="nx">noop</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">header</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">Authorization</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">oauthHeader</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">method</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">path</span> <span class="o">||</span> <span class="nx">path</span><span class="p">)</span>
    <span class="p">};</span>  
    <span class="nx">self</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">headers</span><span class="p">,</span> <span class="nx">header</span><span class="p">);</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">logLevels</span><span class="p">.</span><span class="nx">INFO</span><span class="p">,</span> 
        <span class="s1">&#39;execute() path: %s\n\toptions: %j\n&#39;</span><span class="p">,</span> 
            <span class="nx">path</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>client is either node.js https or http object, depending in useSSL</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">client</span> <span class="o">=</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">useSSL</span><span class="p">)</span> <span class="o">?</span> <span class="nx">https</span> <span class="o">:</span> <span class="nx">http</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Tweeter inherits from EventEmitter for great control over events.
It also allows you to pass in a callback with the signature <br />
<code>function(err,data) { }</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">req</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">setEncoding</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">responseData</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">responseData</span> <span class="o">+=</span> <span class="nx">d</span><span class="p">;</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">d</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">responseData</span><span class="p">);</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
            <span class="nx">req</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">);</span> 
        <span class="p">});</span>
    <span class="p">});</span>    

    <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="k">if</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">req</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>get(path, options, cb)</h2>

<p>A convenience method for HTTP GET requests</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prepareCall</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span> <span class="p">}),</span> <span class="nx">cb</span> <span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h2>post(path, options, get)</h2>

<p>A convenience method for HTTP POST requests</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">post</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prepareCall</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span> <span class="p">}),</span> <span class="nx">cb</span> <span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>TODO: This is a little broken atm <br />
This method is a work-in-progress. <br />
This is supposed to wrap the update_with_media requirements, 
and most likely doesn't belong in this module at all.</p>

<p>This is the only time <code>apiBase</code> should be modified.
The multipart form-data section seems to be messed up, because
responses from twitter's API just say there is an error updating the status
with no status code returned.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">upload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">apiBase</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">apiBase</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Get the media to upload</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">media</span> <span class="o">=</span> <span class="nx">options</span><span class="p">[</span><span class="s1">&#39;media[]&#39;</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">filename</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">filename</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">filetype</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">filetype</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>These don'e need to be in options object anymore</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">delete</span> <span class="nx">options</span><span class="p">[</span><span class="s1">&#39;media[]&#39;</span><span class="p">];</span>
    <span class="k">delete</span> <span class="nx">options</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">];</span>
    <span class="k">delete</span> <span class="nx">options</span><span class="p">[</span><span class="s1">&#39;filetype&#39;</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">boundary</span> <span class="o">=</span> <span class="p">((</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>

    <span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prepareCall</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">cb</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Set Multipart header information</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">multipart</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">apiBase</span> <span class="o">=</span> <span class="s1">&#39;upload.twitter.com&#39;</span><span class="p">;</span>
    <span class="nx">multipart</span><span class="p">.</span><span class="nx">host</span> <span class="o">=</span> <span class="s1">&#39;upload.twitter.com&#39;</span><span class="p">;</span>
    <span class="nx">multipart</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;multipart/form-data&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">media</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;; boundary=&#39;</span> <span class="o">+</span> <span class="nx">boundary</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="nx">multipart</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-Target-URI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://upload.twitter.com&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Create the Multipart body</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">body</span> <span class="o">=</span> <span class="nx">body</span> <span class="o">+</span> 
            <span class="nx">util</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;--%s\r\nContent-Disposition: form-data; name=&quot;%s&quot;\r\n\r\n%s\r\n&#39;</span><span class="p">,</span>
                <span class="nx">boundary</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">options</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
    <span class="p">}</span>
    
    <span class="k">if</span><span class="p">(</span><span class="nx">media</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">body</span> <span class="o">=</span> <span class="nx">body</span> <span class="o">+</span> <span class="nx">util</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;--%s\r\n&#39;</span> <span class="o">+</span> 
            <span class="s1">&#39;Content-Disposition: form-data; name=&quot;media[]&quot;; filename=&quot;%s&quot;\r\n&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;Content-Type: %s\r\n\r\n%s\r\n&#39;</span><span class="p">,</span>
            <span class="nx">boundary</span><span class="p">,</span> <span class="nx">filename</span> <span class="o">||</span> <span class="s1">&#39;new-file.png&#39;</span><span class="p">,</span> <span class="nx">filetype</span> <span class="o">||</span> <span class="s1">&#39;image/png&#39;</span><span class="p">,</span> <span class="nx">media</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">body</span> <span class="o">=</span> <span class="nx">body</span> <span class="o">+</span> <span class="nx">util</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;--%s--\r\n&#39;</span><span class="p">,</span> <span class="nx">boundary</span><span class="p">);</span>

    <span class="nx">multipart</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;Content-length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="nx">body</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Start the upload</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">useSSL</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">multipart</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span> <span class="p">}),</span> 
        <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">cb</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">cb</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">cb</span><span class="p">();</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>reset apiBase.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">apiBase</span> <span class="o">=</span> <span class="nx">apiBase</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h2>put(path, options, cb)</h2>

<p>A convenience method for HTTP PUT requests</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">put</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prepareCall</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;PUT&#39;</span> <span class="p">}),</span> <span class="nx">cb</span> <span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h2>delete(path, options, cb)</h2>

<p>A convenience method for HTTP DELETE requests</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="k">delete</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prepareCall</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;DELETE&#39;</span> <span class="p">}),</span> <span class="nx">cb</span> <span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h2>head(path, options, cb)</h2>

<p>A convenience method for HTTP HEAD requests</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">head</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prepareCall</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;HEAD&#39;</span> <span class="p">}),</span> <span class="nx">cb</span> <span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h2>log(level, msg)</h2>

<p>A convenience method for logging. <br />
<code>level</code> may be a number 0-5 or <code>logLevel</code> object.
msg may be a string or a formattable string followed by options.  </p>

<p>Example with a string:  </p>

<pre><code> tweeter.log(tweeter.logLevels.DEBUG,
     'My debug log message');
</code></pre>

<p>Example with a format string:</p>

<pre><code> tweeter.log(0, 
     'Object: %j\nString: %s\nNumber: %d',
     { asdf: 'asdf' }, 'some string', 5);
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">level</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Generates the oauth header object</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">oauthHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">mergeProps</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
        <span class="nx">parts</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">),</span>
        <span class="nx">path</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="nx">query</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">headerObj</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">oauth_consumer_key</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">consumerKey</span><span class="p">,</span>
        <span class="nx">oauth_nonce</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">test_nonce</span> <span class="o">||</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="p">),</span>
        <span class="nx">oauth_signature_method</span><span class="o">:</span> <span class="s1">&#39;HMAC-SHA1&#39;</span><span class="p">,</span>
        <span class="nx">oauth_timestamp</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">test_timestamp</span> <span class="o">||</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">+</span><span class="p">(</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">-</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getMilliseconds</span><span class="p">()</span> <span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">)),</span>
        <span class="nx">oauth_version</span><span class="o">:</span> <span class="s1">&#39;1.0&#39;</span>
    <span class="p">};</span>  </pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>only add the access token if it exists</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">headerObj</span><span class="p">.</span><span class="nx">oauth_token</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">token</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">headerObj</span><span class="p">.</span><span class="nx">oauth_token</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>if the request token exists, but the access token doesn't, add the request token</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">headerObj</span><span class="p">.</span><span class="nx">oauth_token</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">token</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">headerObj</span><span class="p">,</span> <span class="nx">mergeProps</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>If the requested path contains /oauth/*, we have to provide the callback</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span><span class="p">(</span> <span class="nx">path</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\/oauth\//gi</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">headerObj</span><span class="p">.</span><span class="nx">oauth_callback</span> <span class="o">=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">oauthCallback</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Gets the oauth signature and adds it to the header</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">oauthSignature</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">headerObj</span><span class="p">,</span> <span class="nx">query</span><span class="p">);</span>
    <span class="nx">headerObj</span><span class="p">.</span><span class="nx">oauth_signature</span> <span class="o">=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">signature</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>concat the header object into a csv string</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">header</span> <span class="o">=</span> <span class="s1">&#39;OAuth realm=&quot;Twitter API&quot;,&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">oauthParts</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">h</span> <span class="k">in</span> <span class="nx">headerObj</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">oauthParts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">h</span> <span class="o">+</span> <span class="s1">&#39;=&quot;&#39;</span><span class="o">+</span><span class="nx">headerObj</span><span class="p">[</span><span class="nx">h</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">header</span><span class="o">+=</span> <span class="nx">oauthParts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">logLevels</span><span class="p">.</span><span class="nx">DEBUG</span><span class="p">,</span> 
        <span class="s1">&#39;oauthHeader()\n\tHeader: %j\n&#39;</span><span class="p">,</span> <span class="nx">header</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="nx">header</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Creates the HMAC-SHA1 encrypted signature string</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">oauthSignature</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">props</span><span class="p">,</span> <span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>twitter expects either <br />
<code>consumerSecret&amp;accessTokenSecret</code> or <code>consumerSecret&amp;</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">composite</span> <span class="o">=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">consumerSecret</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&amp;&#39;</span> <span class="o">+</span> 
        <span class="nx">qs</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">accessTokenSecret</span><span class="o">||</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">logLevels</span><span class="p">.</span><span class="nx">DEBUG</span><span class="p">,</span> 
        <span class="s1">&#39;oauthSignature() options:\n\tComposite: %s\n\tconsumerSecret: %s\n\taccessTokenSecret: %s\n&#39;</span><span class="p">,</span> 
            <span class="nx">composite</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">consumerSecret</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">accessTokenSecret</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">hmac</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="s1">&#39;sha1&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">composite</span><span class="p">)</span> <span class="p">);</span>
    <span class="kd">var</span> <span class="nx">sig</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">createSignatureBaseString</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">props</span><span class="p">,</span> <span class="nx">query</span><span class="p">);</span>

    <span class="nx">hmac</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">sig</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">hmacDigest</span> <span class="o">=</span> <span class="nx">hmac</span><span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s1">&#39;base64&#39;</span><span class="p">);</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">logLevels</span><span class="p">.</span><span class="nx">DEBUG</span><span class="p">,</span> 
        <span class="s1">&#39;oauthSignature() encryption parts:\n\tHMAC-SHA1: %s\n\tHashing: %s\n\tSalt: %s\n&#39;</span><span class="p">,</span>
            <span class="nx">hmacDigest</span><span class="p">,</span> <span class="nx">sig</span><span class="p">,</span> <span class="nx">composite</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">hmacDigest</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Creates the signature base string which is to be encrypted. <br />
For an example, see <a href="https://dev.twitter.com/docs/auth/oauth#Signing_Requests">Signing Requests</a>  </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createSignatureBaseString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">props</span><span class="p">,</span> <span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">oauthProperties</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">oauthProperties</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>If the query string is included, it must be added.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
            <span class="k">for</span><span class="p">(</span> <span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">q</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">oauthProperties</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">k</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nx">q</span><span class="p">[</span><span class="nx">k</span><span class="p">])</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>properties should be sorted by key, <em>then</em> by property.
if we push everything as a single string to the array, then sort the array,
we end up with the same effect and less error-prone code.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">for</span><span class="p">(</span> <span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">props</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">props</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">oauthProperties</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;%3D&#39;</span><span class="o">+</span><span class="nx">qs</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">props</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">oauthProperties</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">logLevels</span><span class="p">.</span><span class="nx">DEBUG</span><span class="p">,</span> 
            <span class="s1">&#39;createSignatureBaseString()\n\tSorted array: %j&#39;</span><span class="p">,</span> <span class="nx">oauthProperties</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">uri</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;http%s://%s%s&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">useSSL</span><span class="o">?</span><span class="s1">&#39;s&#39;</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="nx">self</span><span class="p">.</span><span class="nx">apiBase</span><span class="p">,</span> <span class="nx">path</span><span class="o">||</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">sig</span> <span class="o">=</span> <span class="nx">method</span><span class="o">+</span><span class="s1">&#39;&amp;&#39;</span><span class="o">+</span><span class="nx">qs</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;&amp;&#39;</span> <span class="o">+</span> <span class="nx">oauthProperties</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;%26&#39;</span><span class="p">);</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">logLevels</span><span class="p">.</span><span class="nx">DEBUG</span><span class="p">,</span> 
        <span class="s1">&#39;createSignatureBaseString()\n\tSignature: %s\n&#39;</span><span class="p">,</span> <span class="nx">sig</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">sig</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <h2>authenticate(callback)</h2>

<p>Begins the OAuth 'dance'.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">authenticate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">cb</span> <span class="o">=</span> <span class="nx">cb</span> <span class="o">||</span> <span class="nx">noop</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>These aren't currently set anywhere.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">isAuthenticated</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">self</span><span class="p">.</span><span class="nx">authenticationError</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cb</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getRequestToken</span><span class="p">(</span><span class="nx">cb</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>returns the authorizationUrl to the callback's data object
<code>function(err,data)</code> is expected callback signature. <br />
To access the authorizationUrl, use: <br />
<code>data.authUrl</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getRequestToken</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">cb</span> <span class="o">=</span> <span class="nx">cb</span><span class="o">||</span><span class="nx">noop</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">useSSL</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/oauth/request_token&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">data</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/Failed/gi</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">oauth_callback_confirmed</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">token</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">oauth_token</span><span class="p">;</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">tokenSecret</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">oauth_token_secret</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Callback was not accepted by Twitter API&quot;</span><span class="p">));</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>TODO: just return the string as data instead of creating a new object</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span> <span class="nx">authUrl</span><span class="o">:</span> <span class="nx">util</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;%s?oauth_token=%s&#39;</span><span class="p">,</span> 
            <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">authorizeUrl</span><span class="o">||</span><span class="s1">&#39;http://api.twitter.com/oauth/authorize&#39;</span><span class="p">),</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">token</span><span class="p">)</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <h2>parseCallback(requestUrl, callback)</h2>

<p>Parses the callback URL (token and verifier) <br />
For an example, see the <a href="https://dev.twitter.com/docs/auth/oauth#Sending_the_user_to_authorization">API docs</a></p>

<p>Note: fn can be your call to the api.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">reqUrl</span><span class="p">,</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">reqUrl</span><span class="o">||</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">query</span><span class="p">);</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">logLevels</span><span class="p">.</span><span class="nx">DEBUG</span><span class="p">,</span> 
        <span class="s1">&#39;parseCallback()\n\tvalues:%j\n\tresponse%j&#39;</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">response</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">token</span> <span class="o">==</span> <span class="nx">response</span><span class="p">.</span><span class="nx">oauth_token</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">verifier</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">oauth_verifier</span><span class="p">;</span>
    <span class="p">}</span>  
    <span class="nx">self</span><span class="p">.</span><span class="nx">getAccessToken</span><span class="p">(</span><span class="nx">fn</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Requests an access token from twitter's API</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAccessToken</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">fn</span> <span class="o">=</span> <span class="nx">fn</span><span class="o">||</span><span class="nx">noop</span><span class="p">;</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">logLevels</span><span class="p">.</span><span class="nx">DBUG</span><span class="p">,</span> <span class="s1">&#39;getAccessToken()&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/oauth/access_token&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">logLevels</span><span class="p">.</span><span class="nx">DEBUG</span><span class="p">,</span> <span class="s1">&#39;getAccessToken()\n\tresponse: %j&#39;</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">oauth_token</span><span class="p">;</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">accessTokenSecret</span> <span class="o">=</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">oauth_token_secret</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">);</span>        
    <span class="p">});</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Inherit from `EventEmitter`.</span>
<span class="cm"> */</span>
<span class="nx">Tweeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">=</span> <span class="nx">EventEmitter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 